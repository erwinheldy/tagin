class Tagin{t="tagin";i="tagin-wrapper";h="tagin-tag";p="tagin-tag-remove";u="tagin-input";o="tagin-input-hidden";target;l;input;separator;placeholder;duplicate;transform;g;constructor(t,s){this.target=t,this.separator=s?.separator||t.dataset.v||",",this.placeholder=s?.placeholder||t.dataset.m||"",this.duplicate=s?.duplicate||void 0!==t.dataset.T,this.transform=s?.transform||t.dataset.k||"input => input",this.g=s?.g||void 0!==t.dataset.$,this.H(),this.I(),this.addEventListener()}H(){var t=""===this.L()?"":this.getValues().map(t=>this.M(t)).join("");const s=document.createElement("input");s.type="text",s.className=this.u,s.placeholder=this.placeholder;const i=document.createElement("div");i.className=this.i+" "+this.target.className,i.classList.remove(this.t),i.insertAdjacentHTML("afterbegin",t),i.insertAdjacentElement("beforeend",s),this.target.insertAdjacentElement("afterend",i),this.l=i,this.input=s}M(t){return`<span class="${this.h}">${t}<span onclick="this.closest('div').dispatchEvent(new CustomEvent('tagin:remove', { detail: this }))" class="${this.p}"></span></span>`}L(){return this.target.value.trim()}getValues(){return this.L().split(this.separator)}getTags(){return Array.from(this.l.getElementsByClassName(this.h)).map(t=>t.textContent)}V(){return this.getTags().join(this.separator)}A(){this.target.value=this.V(),this.target.dispatchEvent(new Event("change"))}I(){const t=document.createElement("div");t.classList.add(this.u,this.o);const s=this.input.value||this.input.placeholder||"";t.innerHTML=s.replace(/ /g,"&nbsp;"),document.body.appendChild(t),this.input.style.setProperty("width",Math.ceil(parseInt(window.getComputedStyle(t).width.replace("px","")))+1+"px"),t.remove()}addEventListener(){const s=this.l,i=this.input;s.addEventListener("click",()=>i.focus()),i.addEventListener("focus",()=>s.classList.add("focus")),i.addEventListener("blur",()=>s.classList.remove("focus")),i.addEventListener("input",()=>{this.S(),this.I()}),i.addEventListener("blur",()=>{this.S(!0),this.I()}),i.addEventListener("keydown",t=>{""===i.value&&"Backspace"===t.key&&s.getElementsByClassName(this.h).length&&(s.querySelector(`.${this.h}:last-of-type`).remove(),this.A()),""!==i.value&&"Enter"===t.key&&this.g&&(this.S(!0),this.I(),t.preventDefault())}),s.addEventListener("tagin:remove",t=>{t.detail instanceof HTMLSpanElement&&(t.detail.parentElement.remove(),this.A())}),this.target.addEventListener("change",()=>this.W())}S(force=!1){const input=this.input,value=eval(this.transform)(input.value.trim());""===value&&(input.value=""),(input.value.includes(this.separator)||force&&""!==input.value)&&(value.split(this.separator).filter(t=>""!==t).forEach(t=>{this.getTags().includes(t)&&!1===this.duplicate?this.B(t):(input.insertAdjacentHTML("beforebegin",this.M(t)),this.A())}),input.value="",input.removeAttribute("style"))}B(t){for(const s of this.l.getElementsByClassName(this.h))s.textContent===t&&s instanceof HTMLSpanElement&&(s.style.transform="scale(1.09)",setTimeout(()=>{s.removeAttribute("style")},150))}W(){this.L()!==this.V()&&([...this.l.getElementsByClassName(this.h)].map(t=>t.remove()),""!==this.L().trim()&&this.input.insertAdjacentHTML("beforebegin",this.getValues().map(t=>this.M(t)).join("")))}C(t){this.input.value=(Array.isArray(t)?t.join(this.separator):t)+this.separator,this.input.dispatchEvent(new Event("input"))}}export{Tagin as default};